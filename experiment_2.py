# -*- coding: utf-8 -*-
"""Experiment 2.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1_DwDTJ2huveyYff0naRK9VakSZ-6OI6f
"""

import numpy as np
import matplotlib.pyplot as plt
from sklearn.datasets import load_breast_cancer
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import MinMaxScaler
import time
from fully_connected_nn import FullyConnectedNN

data_bc = load_breast_cancer()
X = data_bc.data
y = data_bc.target.reshape(-1, 1)  # Σχήμα (n_samples, 1)

def eval_accuracy(y_pred, y_true):
    return np.mean(y_pred.flatten() == y_true.flatten())

start_time = time.time()
n_repeats = 20
test_accuracies = []

for run in range(n_repeats+1):

    print(f'Επανάληψη {run} από {n_repeats}')

    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=12)

    scaler = MinMaxScaler(feature_range=(0, 1))
    X_train = scaler.fit_transform(X_train)
    X_test  = scaler.transform(X_test)

    model = FullyConnectedNN(input_size=X_train.shape[1], hidden_size=[1, 16], output_size=1, lr=1e-2)

    model.fit(X_train, y_train, iterations=5000, batch_size=64, show_step=1000)

    y_pred_test = model.predict(X_test.T).flatten()

    accuracy_result=eval_accuracy(y_pred_test, y_test)

    test_accuracies.append(accuracy_result)

end_time = time.time()
elapsed_time = end_time - start_time
mean_accuracy = np.mean(test_accuracies)
std_accuracy = np.std(test_accuracies)

print("\n==========================================")
print(f"Μέση ακρίβεια Test Set: {mean_accuracy*100:.2f}%")
print(f"Τυπική απόκλιση Test Set: {std_accuracy*100:.2f}%")
print(f"Συνολικός Χρόνος Εκτέλεσης: {elapsed_time:.2f} δευτερόλεπτα")
print("============================================")